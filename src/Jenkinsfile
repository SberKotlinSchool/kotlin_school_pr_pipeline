def reqPost(url, body) {
    return httpRequest(authentication: 'shariktlt_school_devops', url: url, requestBody: body, httpMode: 'POST', validResponseCodes: '100:599', contentType: 'APPLICATION_JSON')
}

def comment(text) {
    reqPost("${COMMENTS_URL}", "{\"content\":{\"raw\": \"${text}\"}}")
}

pipeline {
    agent any

    parameters {
        string(name: 'SOURCE_SCM', defaultValue: '')
        string(name: 'SOURCE_SCM_BRANCH', defaultValue: '')
        string(name: 'TARGET_SCM', defaultValue: '')
        string(name: 'PR_OWNER', defaultValue: '')
        string(name: 'COMMENTS_URL', defaultValue: '')

    }


    stages {

        stage('Build') {
            steps {

                echo 'Building...'
                comment('Start building')
                echo "SOURCE_SCM = '${SOURCE_SCM}'"
                echo "SOURCE_SCM = '${SOURCE_SCM_BRANCH}'"
                echo "TARGET_SCM = '${TARGET_SCM}'"
                echo "PR_OWNER = '${PR_OWNER}'"
                echo "COMMENTS_URL = '${COMMENTS_URL}'"

            }
        }

        stage('clean_ws'){
            steps {
                cleanWs()
            }
        }

        stage('checkout repository') {
            steps {
                git branch: "${SOURCE_SCM_BRANCH}", url: "${SOURCE_SCM}"
            }
        }
    }
}